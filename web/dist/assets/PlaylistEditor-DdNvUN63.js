import{_ as D,c as i,a as e,e as h,v as _,h as b,F as p,r as y,b as f,w as P,t as c,d as v,o}from"./index-CxGADa4D.js";const g={name:"PlaylistEditor",data(){return{playlistId:null,playlistName:"My New Playlist",items:[],availableScenes:[],defaultPalette:"",defaultDuration:30,defaultPalettes:[],customPalettes:[]}},computed:{totalDuration(){return this.items.reduce((s,t)=>s+(t.duration||30),0)}},async mounted(){await this.fetchScenes(),await this.fetchPalettes();const s=this.$route.params.id;s&&await this.loadPlaylist(s)},methods:{async loadPlaylist(s){try{const m=((await v.getPlaylists()).data.playlists||{})[s];m&&(this.playlistId=m.id,this.playlistName=m.name,this.items=m.items.map(a=>({filename:a.filename,type:a.type,duration:a.duration||m.default_duration||30,name:a.name||a.filename,palette:a.palette||""})),this.defaultPalette=m.default_palette||"",this.defaultDuration=m.default_duration||30)}catch(t){console.error("Failed to load playlist",t)}},async fetchScenes(){try{const s=await v.getScenes();this.availableScenes=s.data.scenes}catch(s){console.error("Failed to load scenes",s)}},async fetchPalettes(){try{const s=await v.getPalettes();this.defaultPalettes=Object.values(s.data.default||{}),this.customPalettes=Object.values(s.data.custom||{})}catch(s){console.error("Failed to load palettes",s)}},addItem(s){this.items.push({filename:s.filename,type:s.type,name:s.name,duration:this.defaultDuration||30,palette:""})},removeItem(s){this.items.splice(s,1)},moveItem(s,t){if(s+t<0||s+t>=this.items.length)return;const n=this.items[s];this.items.splice(s,1),this.items.splice(s+t,0,n)},applyDefaultDuration(){if(!this.defaultDuration||this.defaultDuration<=0){alert("Please set a valid default duration first");return}confirm(`Apply ${this.defaultDuration}s duration to all ${this.items.length} scenes?`)&&this.items.forEach(s=>{s.duration=this.defaultDuration})},onDragStart(s,t){s.dataTransfer.setData("scene",JSON.stringify(t))},onDrop(s){const t=s.dataTransfer.getData("scene");if(t){const n=JSON.parse(t);this.addItem(n)}},async savePlaylist(){if(!this.playlistName)return alert("Please name your playlist");const t={id:this.playlistId||this.playlistName.toLowerCase().replace(/[^a-z0-9]/g,"_"),name:this.playlistName,items:this.items.map(n=>({filename:n.filename,type:n.type,duration:n.duration,palette:n.type==="script"&&n.palette&&n.palette.trim()?n.palette:null})),default_palette:this.defaultPalette&&this.defaultPalette.trim()?this.defaultPalette:null,default_duration:this.defaultDuration&&this.defaultDuration>0?this.defaultDuration:null,settings:{}};try{await v.savePlaylist(t),alert("Playlist Saved!"),this.$router.push("/playlists")}catch(n){alert("Failed to save: "+n)}}}},k={class:"playlist-editor"},S={class:"editor-header"},C={class:"palette-selector"},N={label:"Default Palettes"},w=["value"],I={key:0,label:"Custom Palettes"},V=["value"],U={class:"duration-selector"},F=["disabled"],A={class:"actions"},B={class:"editor-workspace"},E={class:"column source-column"},M={class:"scene-list"},O=["onDragstart"],T={class:"scene-type"},L={class:"scene-name"},j=["onClick"],J={key:0,class:"empty-state"},q={class:"timeline-list"},z={class:"card-header"},G={class:"item-index"},H={class:"scene-name"},K=["onClick"],Q={class:"card-controls"},R=["onUpdate:modelValue"],W={key:0,class:"palette-selector-inline"},X=["onUpdate:modelValue"],Y={label:"Default"},Z=["value"],x={key:0,label:"Custom"},$=["value"],tt={class:"order-controls"},et=["onClick","disabled"],st=["onClick","disabled"];function lt(s,t,n,m,a,u){return o(),i("div",k,[e("header",S,[h(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>a.playlistName=l),placeholder:"Playlist Name",class:"name-input"},null,512),[[_,a.playlistName]]),e("div",C,[t[9]||(t[9]=e("label",null,"Default Palette:",-1)),h(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>a.defaultPalette=l),class:"palette-select"},[t[8]||(t[8]=e("option",{value:""},"None (use global)",-1)),e("optgroup",N,[(o(!0),i(p,null,y(a.defaultPalettes,l=>(o(),i("option",{key:l.id,value:l.id},c(l.name),9,w))),128))]),a.customPalettes.length>0?(o(),i("optgroup",I,[(o(!0),i(p,null,y(a.customPalettes,l=>(o(),i("option",{key:l.id,value:l.id},c(l.name),9,V))),128))])):f("",!0)],512),[[b,a.defaultPalette]])]),e("div",U,[t[10]||(t[10]=e("label",null,"Default Duration (s):",-1)),h(e("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=l=>a.defaultDuration=l),min:"1",step:"0.5",class:"duration-select-input",placeholder:"30"},null,512),[[_,a.defaultDuration,void 0,{number:!0}]]),e("button",{onClick:t[3]||(t[3]=(...l)=>u.applyDefaultDuration&&u.applyDefaultDuration(...l)),class:"apply-duration-btn",disabled:a.items.length===0,title:"Apply default duration to all scenes"}," Apply to All ",8,F)]),e("div",A,[e("button",{onClick:t[4]||(t[4]=(...l)=>u.savePlaylist&&u.savePlaylist(...l)),class:"save-btn"},"ðŸ’¾ Save Playlist"),e("button",{onClick:t[5]||(t[5]=l=>s.$router.push("/library")),class:"cancel-btn"}," Back to Library ")])]),e("div",B,[e("div",E,[t[11]||(t[11]=e("h3",null,"Available Scenes",-1)),e("div",M,[(o(!0),i(p,null,y(a.availableScenes,l=>(o(),i("div",{key:l.filename,class:"scene-card source-card",draggable:"true",onDragstart:d=>u.onDragStart(d,l)},[e("span",T,c(l.type),1),e("span",L,c(l.name),1),e("button",{class:"add-btn",onClick:d=>u.addItem(l)},"+",8,j)],40,O))),128))])]),e("div",{class:"column timeline-column",onDragover:t[6]||(t[6]=P(()=>{},["prevent"])),onDrop:t[7]||(t[7]=(...l)=>u.onDrop&&u.onDrop(...l))},[e("h3",null,"Sequence Timeline ("+c(u.totalDuration)+"s)",1),a.items.length===0?(o(),i("div",J," Drag scenes here or click '+' to add to playlist ")):f("",!0),e("div",q,[(o(!0),i(p,null,y(a.items,(l,d)=>(o(),i("div",{key:d,class:"scene-card timeline-card"},[e("div",z,[e("span",G,c(d+1)+".",1),e("span",H,c(l.name||l.filename),1),e("button",{class:"remove-btn",onClick:r=>u.removeItem(d)},"âŒ",8,K)]),e("div",Q,[t[14]||(t[14]=e("label",null,"Duration (s):",-1)),h(e("input",{type:"number","onUpdate:modelValue":r=>l.duration=r,min:"1",class:"duration-input"},null,8,R),[[_,l.duration,void 0,{number:!0}]]),l.type==="script"?(o(),i("div",W,[t[13]||(t[13]=e("label",null,"Palette:",-1)),h(e("select",{"onUpdate:modelValue":r=>l.palette=r,class:"palette-select-small"},[t[12]||(t[12]=e("option",{value:""},"Default",-1)),e("optgroup",Y,[(o(!0),i(p,null,y(a.defaultPalettes,r=>(o(),i("option",{key:r.id,value:r.id},c(r.name),9,Z))),128))]),a.customPalettes.length>0?(o(),i("optgroup",x,[(o(!0),i(p,null,y(a.customPalettes,r=>(o(),i("option",{key:r.id,value:r.id},c(r.name),9,$))),128))])):f("",!0)],8,X),[[b,l.palette]])])):f("",!0),e("div",tt,[e("button",{onClick:r=>u.moveItem(d,-1),disabled:d===0}," â–² ",8,et),e("button",{onClick:r=>u.moveItem(d,1),disabled:d===a.items.length-1}," â–¼ ",8,st)])])]))),128))])],32)])])}const it=D(g,[["render",lt],["__scopeId","data-v-d4b07b30"]]);export{it as default};

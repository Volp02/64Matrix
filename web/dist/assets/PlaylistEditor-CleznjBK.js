import{_ as b,c as o,a as s,e as h,v as f,g as P,F as p,r as y,b as v,w as g,t as c,d as _,o as i}from"./index-CexK4p7j.js";const k={name:"PlaylistEditor",data(){return{playlistId:null,playlistName:"My New Playlist",items:[],availableScenes:[],defaultPalette:"",defaultPalettes:[],customPalettes:[]}},computed:{totalDuration(){return this.items.reduce((t,e)=>t+(e.duration||10),0)}},async mounted(){await this.fetchScenes(),await this.fetchPalettes();const t=this.$route.params.id;t&&await this.loadPlaylist(t)},methods:{async loadPlaylist(t){try{const m=((await _.getPlaylists()).data.playlists||{})[t];m&&(this.playlistId=m.id,this.playlistName=m.name,this.items=m.items.map(a=>({filename:a.filename,type:a.type,duration:a.duration||10,name:a.name||a.filename,palette:a.palette||""})),this.defaultPalette=m.default_palette||"")}catch(e){console.error("Failed to load playlist",e)}},async fetchScenes(){try{const t=await _.getScenes();this.availableScenes=t.data.scenes}catch(t){console.error("Failed to load scenes",t)}},async fetchPalettes(){try{const t=await _.getPalettes();this.defaultPalettes=Object.values(t.data.default||{}),this.customPalettes=Object.values(t.data.custom||{})}catch(t){console.error("Failed to load palettes",t)}},addItem(t){this.items.push({filename:t.filename,type:t.type,name:t.name,duration:10,palette:""})},removeItem(t){this.items.splice(t,1)},moveItem(t,e){if(t+e<0||t+e>=this.items.length)return;const n=this.items[t];this.items.splice(t,1),this.items.splice(t+e,0,n)},onDragStart(t,e){t.dataTransfer.setData("scene",JSON.stringify(e))},onDrop(t){const e=t.dataTransfer.getData("scene");if(e){const n=JSON.parse(e);this.addItem(n)}},async savePlaylist(){if(!this.playlistName)return alert("Please name your playlist");const e={id:this.playlistId||this.playlistName.toLowerCase().replace(/[^a-z0-9]/g,"_"),name:this.playlistName,items:this.items.map(n=>({filename:n.filename,type:n.type,duration:n.duration,palette:n.type==="script"&&n.palette&&n.palette.trim()?n.palette:null})),default_palette:this.defaultPalette&&this.defaultPalette.trim()?this.defaultPalette:null,settings:{}};try{await _.savePlaylist(e),alert("Playlist Saved!"),this.$router.push("/playlists")}catch(n){alert("Failed to save: "+n)}}}},D={class:"playlist-editor"},S={class:"editor-header"},C={class:"palette-selector"},N={label:"Default Palettes"},w=["value"],I={key:0,label:"Custom Palettes"},V=["value"],F={class:"actions"},U={class:"editor-workspace"},B={class:"column source-column"},M={class:"scene-list"},O=["onDragstart"],T={class:"scene-type"},E={class:"scene-name"},L=["onClick"],j={key:0,class:"empty-state"},J={class:"timeline-list"},q={class:"card-header"},z={class:"item-index"},A={class:"scene-name"},G=["onClick"],H={class:"card-controls"},K=["onUpdate:modelValue"],Q={key:0,class:"palette-selector-inline"},R=["onUpdate:modelValue"],W={label:"Default"},X=["value"],Y={key:0,label:"Custom"},Z=["value"],x={class:"order-controls"},$=["onClick","disabled"],ee=["onClick","disabled"];function te(t,e,n,m,a,d){return i(),o("div",D,[s("header",S,[h(s("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>a.playlistName=l),placeholder:"Playlist Name",class:"name-input"},null,512),[[f,a.playlistName]]),s("div",C,[e[7]||(e[7]=s("label",null,"Default Palette:",-1)),h(s("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>a.defaultPalette=l),class:"palette-select"},[e[6]||(e[6]=s("option",{value:""},"None (use global)",-1)),s("optgroup",N,[(i(!0),o(p,null,y(a.defaultPalettes,l=>(i(),o("option",{key:l.id,value:l.id},c(l.name),9,w))),128))]),a.customPalettes.length>0?(i(),o("optgroup",I,[(i(!0),o(p,null,y(a.customPalettes,l=>(i(),o("option",{key:l.id,value:l.id},c(l.name),9,V))),128))])):v("",!0)],512),[[P,a.defaultPalette]])]),s("div",F,[s("button",{onClick:e[2]||(e[2]=(...l)=>d.savePlaylist&&d.savePlaylist(...l)),class:"save-btn"},"ðŸ’¾ Save Playlist"),s("button",{onClick:e[3]||(e[3]=l=>t.$router.push("/library")),class:"cancel-btn"}," Back to Library ")])]),s("div",U,[s("div",B,[e[8]||(e[8]=s("h3",null,"Available Scenes",-1)),s("div",M,[(i(!0),o(p,null,y(a.availableScenes,l=>(i(),o("div",{key:l.filename,class:"scene-card source-card",draggable:"true",onDragstart:u=>d.onDragStart(u,l)},[s("span",T,c(l.type),1),s("span",E,c(l.name),1),s("button",{class:"add-btn",onClick:u=>d.addItem(l)},"+",8,L)],40,O))),128))])]),s("div",{class:"column timeline-column",onDragover:e[4]||(e[4]=g(()=>{},["prevent"])),onDrop:e[5]||(e[5]=(...l)=>d.onDrop&&d.onDrop(...l))},[s("h3",null,"Sequence Timeline ("+c(d.totalDuration)+"s)",1),a.items.length===0?(i(),o("div",j," Drag scenes here or click '+' to add to playlist ")):v("",!0),s("div",J,[(i(!0),o(p,null,y(a.items,(l,u)=>(i(),o("div",{key:u,class:"scene-card timeline-card"},[s("div",q,[s("span",z,c(u+1)+".",1),s("span",A,c(l.name||l.filename),1),s("button",{class:"remove-btn",onClick:r=>d.removeItem(u)},"âŒ",8,G)]),s("div",H,[e[11]||(e[11]=s("label",null,"Duration (s):",-1)),h(s("input",{type:"number","onUpdate:modelValue":r=>l.duration=r,min:"1",class:"duration-input"},null,8,K),[[f,l.duration,void 0,{number:!0}]]),l.type==="script"?(i(),o("div",Q,[e[10]||(e[10]=s("label",null,"Palette:",-1)),h(s("select",{"onUpdate:modelValue":r=>l.palette=r,class:"palette-select-small"},[e[9]||(e[9]=s("option",{value:""},"Default",-1)),s("optgroup",W,[(i(!0),o(p,null,y(a.defaultPalettes,r=>(i(),o("option",{key:r.id,value:r.id},c(r.name),9,X))),128))]),a.customPalettes.length>0?(i(),o("optgroup",Y,[(i(!0),o(p,null,y(a.customPalettes,r=>(i(),o("option",{key:r.id,value:r.id},c(r.name),9,Z))),128))])):v("",!0)],8,R),[[P,l.palette]])])):v("",!0),s("div",x,[s("button",{onClick:r=>d.moveItem(u,-1),disabled:u===0}," â–² ",8,$),s("button",{onClick:r=>d.moveItem(u,1),disabled:u===a.items.length-1}," â–¼ ",8,ee)])])]))),128))])],32)])])}const le=b(k,[["render",te],["__scopeId","data-v-1e37b4e2"]]);export{le as default};
